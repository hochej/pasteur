<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pasteur</title>
    <meta
      name="description"
      content="Pasteur is a macOS menu bar app that turns clipboard molecules into a floating 3D viewer in a single hotkey."
    />
    <meta name="theme-color" content="#0b0f14" />
    <link rel="canonical" href="https://pasteur.bar/" />
    <meta property="og:title" content="Pasteur" />
    <meta
      property="og:description"
      content="Instant molecular structure visualization from your clipboard. Copy a PDB, press a hotkey, and a floating viewer appears."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://pasteur.bar/" />
    <meta property="og:image" content="https://pasteur.bar/icon.png" />
    <meta name="twitter:card" content="summary_large_image" />

    <link rel="icon" href="./icon.png" type="image/png" />
    <link rel="apple-touch-icon" href="./icon.png" />
    <link rel="stylesheet" href="./molstar/molstar.css" />
    <link rel="stylesheet" href="./site.css?v=20250301f" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,300..800&family=Newsreader:opsz,wght@6..72,300..700&family=IBM+Plex+Mono:wght@400;600&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <main class="wrap">
      <header class="top" data-animate="1">
        <a class="brand" href="https://pasteur.bar/" aria-label="Pasteur home">
          <span class="mark">
            <img src="./icon.png" alt="" width="44" height="44" aria-hidden="true" />
          </span>
          <span class="wordmark">
            <span class="title">Pasteur</span>
            <span class="tagline">Clipboard to molecule, instantly.</span>
          </span>
        </a>
        <nav class="links" aria-label="Links">
          <a class="btn primary" href="https://github.com/hochej/pasteur/releases/latest">Download</a>
          <a class="btn ghost" href="https://github.com/hochej/pasteur">Source</a>
        </nav>
      </header>

      <section class="hero" aria-label="Overview" data-animate="2">
        <div class="copy">
          <div class="badge-row" aria-label="Highlights">
            <span class="badge">macOS menu bar</span>
            <span class="badge">On-device only</span>
            <span class="badge">PDB, mmCIF, SDF, MOL2, XYZ</span>
          </div>
          <h1>Instant molecular structure previews from your clipboard.</h1>
          <p>
            Pasteur sits quietly in your menu bar. Copy a molecule, hit your hotkey, and a floating 3D viewer appears.
            No Dock icon. No network calls. Just a fast, focused visual check.
          </p>
          <div class="cta">
            <a class="btn primary" href="#download">Get Pasteur</a>
            <a class="btn" href="#how">How it works</a>
          </div>
          <div class="keyline" aria-label="Default hotkey example">
            <span class="key">Cmd</span>
            <span class="key">Shift</span>
            <span class="key">V</span>
            <span class="key-label">Default hotkey</span>
          </div>
          <ul class="bullets" aria-label="What it does">
            <li>Detects molecular formats with zero clicks.</li>
            <li>Preloads the viewer for sub-second reveals.</li>
            <li>Privacy-first: clipboard reads only on explicit action.</li>
          </ul>
        </div>
        <div class="specimen" role="region" aria-label="Clipboard viewer demo">
          <div class="specimen-header">
            <span class="specimen-title">Clipboard Viewer</span>
            <span class="pill">Live demo</span>
          </div>
          <div class="specimen-body">
            <div class="viewer-frame">
              <div id="molstar-viewer" class="molstar-host" aria-label="Molecular structure preview"></div>
              <div class="viewer-overlay" aria-live="polite">
                <span class="viewer-status" id="viewer-status">Initializing viewer...</span>
              </div>
            </div>
          </div>
          <div class="specimen-footer">
            <div class="viewer-actions">
              <button class="btn primary compact" id="clipboard-btn" type="button">Render from clipboard</button>
              <button class="btn compact" id="sample-btn" type="button">Load example</button>
            </div>
            <div class="viewer-hint" id="viewer-hint">Paste PDB, mmCIF, SDF, MOL2, MOL, or XYZ.</div>
          </div>
        </div>
      </section>

      <section class="steps" id="how" aria-label="How it works" data-reveal>
        <div class="section-title">
          <h2>Three moves. One molecule.</h2>
          <p>Pasteur is tuned for instant validation while you work.</p>
        </div>
        <div class="step-grid">
          <article class="step">
            <span class="step-index">01</span>
            <h3>Copy</h3>
            <p>Grab a structure in PDB, mmCIF, SDF, MOL2, MOL, or XYZ.</p>
          </article>
          <article class="step">
            <span class="step-index">02</span>
            <h3>Hotkey</h3>
            <p>Hit your global shortcut. Pasteur reads the clipboard on demand.</p>
          </article>
          <article class="step">
            <span class="step-index">03</span>
            <h3>View</h3>
            <p>A floating panel appears with Molstar ready to rotate, inspect, and screenshot.</p>
          </article>
        </div>
      </section>

      <section class="features" aria-label="Features" data-reveal>
        <div class="card">
          <h3>Format intelligence</h3>
          <p>MOL2, SDF, MOL, PDB, CIF, XYZ. Detected in priority order with fast heuristics.</p>
        </div>
        <div class="card">
          <h3>Zero friction</h3>
          <p>Viewer preloads at launch, so the hotkey path stays sub-second.</p>
        </div>
        <div class="card">
          <h3>Private by design</h3>
          <p>No background scraping. Clipboard reads happen only when you ask.</p>
        </div>
      </section>

      <section class="formats" aria-label="Supported formats" data-reveal>
        <div class="section-title">
          <h2>Formats with a point of view.</h2>
          <p>Most specific first, every time.</p>
        </div>
        <div class="format-grid">
          <div class="format">
            <span class="format-tag">MOL2</span>
            <p>Tripos sections detected by @&lt;TRIPOS&gt;.</p>
          </div>
          <div class="format">
            <span class="format-tag">SDF / MOL</span>
            <p>V2000 / V3000 blocks with M  END signatures.</p>
          </div>
          <div class="format">
            <span class="format-tag">PDB / mmCIF</span>
            <p>ATOM, HETATM, HEADER, or data_/_atom_site cues.</p>
          </div>
          <div class="format">
            <span class="format-tag">XYZ</span>
            <p>Atom counts and coordinate lines for quick sanity checks.</p>
          </div>
        </div>
      </section>

      <section class="cta-panel" id="download" aria-label="Download" data-reveal>
        <div class="cta-copy">
          <h2>Pasteur lives where you work.</h2>
          <p>
            A lightweight menu bar companion built for scientists who live in terminals, editors, and notebooks. Free
            and open source.
          </p>
        </div>
        <div class="cta-actions">
          <a class="btn primary" href="https://github.com/hochej/pasteur/releases/latest">Download latest</a>
          <a class="btn" href="https://github.com/hochej/pasteur">View source</a>
        </div>
      </section>

      <footer class="foot" data-reveal>
        <p>
          Pasteur is MIT licensed. Built for macOS, powered by Molstar. Hosted at
          <a href="https://pasteur.bar/">pasteur.bar</a>.
        </p>
      </footer>
    </main>

    <script src="./molstar/molstar.js"></script>
    <script>
      const revealTargets = document.querySelectorAll("[data-reveal]");
      const reveal = new IntersectionObserver(
        entries => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add("is-visible");
              reveal.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.2 }
      );
      revealTargets.forEach(target => reveal.observe(target));

      const viewerHost = document.getElementById("molstar-viewer");
      const statusEl = document.getElementById("viewer-status");
      const overlayEl = document.querySelector(".viewer-overlay");
      const clipboardBtn = document.getElementById("clipboard-btn");
      const sampleBtn = document.getElementById("sample-btn");
      const hintEl = document.getElementById("viewer-hint");

      const sampleStructure = `12
Benzene
C 0.000 1.396 0.000
C 1.209 0.698 0.000
C 1.209 -0.698 0.000
C 0.000 -1.396 0.000
C -1.209 -0.698 0.000
C -1.209 0.698 0.000
H 0.000 2.479 0.000
H 2.147 1.240 0.000
H 2.147 -1.240 0.000
H 0.000 -2.479 0.000
H -2.147 -1.240 0.000
H -2.147 1.240 0.000`;

      let viewer = null;

      const setStatus = (message, tone) => {
        if (!statusEl) return;
        statusEl.textContent = message;
        if (tone) {
          statusEl.dataset.tone = tone;
        } else {
          statusEl.removeAttribute("data-tone");
        }
        if (overlayEl) {
          const hideOverlay = tone === "ready" || !tone;
          overlayEl.classList.toggle("is-hidden", hideOverlay);
        }
      };

      const detectFormat = text => {
        const trimmed = text.trim();
        if (!trimmed) return null;
        const upper = trimmed.toUpperCase();
        if (upper.includes("@<TRIPOS>")) return "mol2";
        if (upper.includes("$$$$") && upper.includes("M  END")) return "sdf";
        if (upper.includes("M  END") && (upper.includes("V2000") || upper.includes("V3000"))) return "mol";
        if (/^(ATOM|HETATM|HEADER|MODEL)/m.test(trimmed)) return "pdb";
        if (/^data_/m.test(trimmed) || /_atom_site\\./.test(trimmed)) return "mmcif";
        const firstLine = trimmed.split(/\\r?\\n/)[0]?.trim();
        if (firstLine && /^\\d+$/.test(firstLine)) return "xyz";
        return null;
      };

      const loadStructure = async (data, format, label) => {
        if (!viewer) return;
        setStatus(`Loading ${label} (${format.toUpperCase()})...`, "busy");
        try {
          await viewer.plugin.clear();
          await viewer.loadStructureFromData(data, format, { dataLabel: label });
          setStatus(`Loaded ${label} (${format.toUpperCase()})`, "ready");
        } catch (error) {
          const message = error instanceof Error ? error.message : String(error);
          setStatus(`Unable to render molecule: ${message}`, "error");
        }
      };

      const initViewer = async () => {
        if (!viewerHost || !window.molstar) {
          setStatus("Viewer unavailable.", "error");
          return;
        }
        try {
          viewer = await window.molstar.Viewer.create(viewerHost, {
            layoutIsExpanded: false,
            layoutShowControls: false,
            layoutShowRemoteState: false,
            layoutShowSequence: false,
            layoutShowLog: false,
            layoutShowLeftPanel: false,
            layoutShowRightPanel: false,
            layoutShowMainMenu: false,
            collapseLeftPanel: true,
            collapseRightPanel: true,
            viewportShowControls: false,
            viewportShowReset: false,
            viewportShowSettings: false,
            viewportShowSelectionMode: false,
            viewportShowAnimation: false,
            viewportShowScreenshotControls: false,
            viewportShowToggleFullscreen: false,
            viewportShowTrajectoryControls: false,
            viewportShowExpand: false
          });
          viewer.plugin.canvas3d?.setProps({
            transparentBackground: false,
            checkeredTransparentBackground: false,
            renderer: { backgroundColor: 0x0b0f14 },
            camera: {
              helper: {
                axes: { name: "off", params: {} }
              }
            }
          });
          viewer.plugin.layout.setProps({
            isExpanded: false,
            showControls: false,
            regionState: {
              left: "hidden",
              right: "hidden",
              top: "hidden",
              bottom: "hidden"
            }
          });
          requestAnimationFrame(() => {
            viewer?.handleResize();
          });
          if (!navigator.clipboard?.readText) {
            if (hintEl) {
              hintEl.textContent = "Clipboard access requires https + permission.";
            }
          }
          await loadStructure(sampleStructure, "xyz", "Example");
        } catch (error) {
          const message = error instanceof Error ? error.message : String(error);
          setStatus(`Viewer failed: ${message}`, "error");
        }
      };

      const loadFromClipboard = async () => {
        if (!navigator.clipboard?.readText) {
          setStatus("Clipboard access is not available in this browser.", "error");
          return;
        }
        try {
          setStatus("Reading clipboard...", "busy");
          const text = await navigator.clipboard.readText();
          const format = detectFormat(text);
          if (!format) {
            setStatus("Clipboard format not recognized.", "error");
            return;
          }
          await loadStructure(text, format, "Clipboard");
        } catch (error) {
          const message = error instanceof Error ? error.message : String(error);
          setStatus(`Clipboard read failed: ${message}`, "error");
        }
      };

      if (clipboardBtn) {
        clipboardBtn.addEventListener("click", () => {
          void loadFromClipboard();
        });
      }

      if (sampleBtn) {
        sampleBtn.addEventListener("click", () => {
          void loadStructure(sampleStructure, "xyz", "Example");
        });
      }

      if (!navigator.clipboard?.readText && clipboardBtn) {
        clipboardBtn.disabled = true;
      }

      if (viewerHost && window.ResizeObserver) {
        const resizeObserver = new ResizeObserver(() => {
          viewer?.handleResize();
        });
        resizeObserver.observe(viewerHost);
      }

      window.addEventListener("unload", () => {
        viewer?.dispose();
      });

      void initViewer();
    </script>
  </body>
</html>
